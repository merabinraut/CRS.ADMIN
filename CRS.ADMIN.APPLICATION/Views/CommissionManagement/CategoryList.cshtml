@model CRS.ADMIN.APPLICATION.Models.CommissionManagement.CommissionCategoryRazorViewModel
@{
    ViewBag.Title = "Category List";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var addEditModel = Model.AddEditCommissionCategory;
}

<div class="px-8 py-4 flex flex-col gap-8">
    <div class="grid gap-8">
        <div class="flex justify-between items-center">
            <div>
                <div class="heading-title">
                    @CRS.ADMIN.APPLICATION.Resources.Resource.Commission_Management
                </div>
                <div class="span-title-light-gray">
                    @CRS.ADMIN.APPLICATION.Resources.Resource.Manage_Commission
                </div>
            </div>
        </div>

        <!-- tab  -->
        <div class="">
            <div class="flex gap-[24px]" style="border-bottom: 1px solid #f4f4f4;">
                <div class="flex tab-container-plane bg-white gap-[16px] text-[#667085]">
                    <button id="tab1Button" class="tab-button-plane tab-link active">
                        @CRS.ADMIN.APPLICATION.Resources.Resource.Commission
                    </button>
                    <button id="tab2Button" class="tab-button-plane tab-link ">
                        @CRS.ADMIN.APPLICATION.Resources.Resource.Assign_Commission
                    </button>
                </div>
            </div>
        </div>
        <div class="">
            <div class="bg-white">
                <div id="tab1" class="tab-content-plane ">
                    <div class="flex justify-between pt-[24px] pb-[24px]">
                        <form>
                            <div class="relative input-search-wrapper">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-[16px] pointer-events-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                                        <path d="M17.5 18L13.875 14.375M15.8333 9.66667C15.8333 13.3486 12.8486 16.3333 9.16667 16.3333C5.48477 16.3333 2.5 13.3486 2.5 9.66667C2.5 5.98477 5.48477 3 9.16667 3C12.8486 3 15.8333 5.98477 15.8333 9.66667Z"
                                              stroke="#667085" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round">
                                        </path>
                                    </svg>
                                </div>
                                <input type="search" class="input-search block w-full "
                                       placeholder="@CRS.ADMIN.APPLICATION.Resources.Resource.Search"
                                       required="">
                            </div>
                        </form>
                        <div class="btn btn-primary gap-[8px] h-[40px]" data-drawer-target="add-new-commision"
                             data-drawer-show="add-new-commision" data-drawer-placement="right" data-drawer-backdrop="false"
                             aria-controls="drawer-disabled-backdrop">
                            <img src="~/Content/assets_new/images/plus-circle-solid.svg">
                            @CRS.ADMIN.APPLICATION.Resources.Resource.Add_New
                        </div>
                    </div>
                    <div class="table-tab">
                        <div class="px-[16px] py-[12px] flex justify-between entry-export-container">
                            <div class="flex items-center select-entries">
                                @*@CRS.ADMIN.APPLICATION.Resources.Resource.Show&nbsp;
                            <select id="countries" class="w-full select-entires " style="width: 100%; ">
                                <option value="5" selected>5</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="20">100</option>
                            </select>&nbsp;@CRS.ADMIN.APPLICATION.Resources.Resource.Entries*@
                            </div>
                            <div class="export-button h-[40px]">
                                <img src="~/Content/assets_new/images/club/download-solid.svg"> @CRS.ADMIN.APPLICATION.Resources.Resource.Export
                            </div>

                        </div>

                        <div class="relative overflow-x-auto">
                            <table class="w-full  text-left club-table">
                                <thead class="club-table-thead">
                                    <tr>
                                        <th scope="col" class="p-[12px]">
                                            <div class="flex">
                                                S.N
                                                <div class="relative pl-[5px]">
                                                    <i class="fa-solid fa-chevron-up text-[8px] absolute top-[2px] text-[#545659]"></i>
                                                    <i class="fa-solid fa-chevron-down text-[8px] absolute top-[8px] let-[5px] text-[#c3b6b9]"></i>
                                                </div>
                                            </div>
                                        </th>
                                        <th scope="col" class="p-[12px]">
                                            <div class="flex">
                                                @CRS.ADMIN.APPLICATION.Resources.Resource.Category_Name
                                                <div class="relative pl-[5px]">
                                                    <i class="fa-solid fa-chevron-up text-[8px] absolute top-[2px] text-[#545659]"></i>
                                                    <i class="fa-solid fa-chevron-down text-[8px] absolute top-[8px] let-[5px] text-[#c3b6b9]"></i>
                                                </div>
                                            </div>
                                        </th>
                                        <th scope="col" class="p-[12px]">
                                            <div class="flex">
                                                @CRS.ADMIN.APPLICATION.Resources.Resource.Created_By
                                                <div class="relative pl-[5px]">
                                                    <i class="fa-solid fa-chevron-up text-[8px] absolute top-[2px] text-[#545659]"></i>
                                                    <i class="fa-solid fa-chevron-down text-[8px] absolute top-[8px] let-[5px] text-[#c3b6b9]"></i>
                                                </div>
                                            </div>
                                        </th>
                                        <th scope="col" class="p-[12px]">
                                            <div class="flex">
                                                @CRS.ADMIN.APPLICATION.Resources.Resource.Created_On
                                                <div class="relative pl-[5px]">
                                                    <i class="fa-solid fa-chevron-up text-[8px] absolute top-[2px] text-[#545659]"></i>
                                                    <i class="fa-solid fa-chevron-down text-[8px] absolute top-[8px] let-[5px] text-[#c3b6b9]"></i>
                                                </div>
                                            </div>
                                        </th>
                                        <th scope="col" class="p-[12px]">
                                            <div class="flex">
                                                @CRS.ADMIN.APPLICATION.Resources.Resource.Status
                                                <div class="relative pl-[5px]">
                                                    <i class="fa-solid fa-chevron-up text-[8px] absolute top-[2px] text-[#545659]"></i>
                                                    <i class="fa-solid fa-chevron-down text-[8px] absolute top-[8px] let-[5px] text-[#c3b6b9]"></i>
                                                </div>
                                            </div>
                                        </th>

                                        <th scope="col" class="p-[12px]">
                                            <div class="flex justify-center">
                                                @CRS.ADMIN.APPLICATION.Resources.Resource.Action
                                                <div class="relative pl-[5px]">
                                                    <i class="fa-solid fa-chevron-up text-[8px] absolute top-[2px] text-[#545659]"></i>
                                                    <i class="fa-solid fa-chevron-down text-[8px] absolute top-[8px] let-[5px] text-[#c3b6b9]"></i>
                                                </div>
                                            </div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        int rowCount = 1;
                                        foreach (var item in Model.CommissionCategoryModelGrid)
                                        {
                                            <tr class="bg-white border-b ">
                                                <td class="p-[12px]">
                                                    @rowCount
                                                </td>
                                                <td class="p-[12px]">
                                                    <div class="w-max">
                                                        @item.CategoryName
                                                    </div>
                                                </td>
                                                <td class="p-[12px]">
                                                    <div class="round-image-text flex gap-[12px] w-max">
                                                        @if (string.IsNullOrWhiteSpace(item.CreatedByImage))
                                                        {
                                                            <img class="w-[32px] h-[32px] rounded-full" src="~/Content/assets_new/images/demo-image.jpeg">
                                                        }
                                                        else
                                                        {
                                                            <img class="w-[32px] h-[32px] rounded-full" src="@item.CreatedByImage" alt="Image">
                                                        }
                                                        <div class="flex justify-between w-full">
                                                            <div class="text-image grid flex-none ">
                                                                <div class="text-sm font-semibold text-[#101828] ">
                                                                    @item.CreatedByFullName
                                                                </div>
                                                                <div class="text-xs  text-[#404040] ">
                                                                    @item.CreatedByUsername
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="p-[12px]">
                                                    <div class="w-max">
                                                        @item.CreatedDate
                                                    </div>
                                                </td>
                                                <td class="p-[12px]">
                                                    @if (item.Status == "A")
                                                    {
                                                        <div class="w-max approved">
                                                            Active
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="w-max blocked">
                                                            Blocked
                                                        </div>
                                                    }
                                                </td>

                                                <td class="p-[12px]">
                                                    <div class="flex gap-[7px] justify-center text-[16px] ">
                                                        <div class="cursor-pointer"
                                                             onclick="viewSubCategoryList('@item.CategoryId','@item.CategoryName')">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"
                                                                 fill="none">
                                                                <g clip-path="url(#clip0_4164_81696)">
                                                                    <path d="M12.25 6.5C5.99805 6.5 1.1875 12.0078 1.1875 12.0078L0.742188 12.5L1.1875 12.9922C1.1875 12.9922 5.57324 17.9932 11.4062 18.4531C11.6846 18.4883 11.9629 18.5 12.25 18.5C12.5371 18.5 12.8154 18.4883 13.0938 18.4531C18.9268 17.9932 23.3125 12.9922 23.3125 12.9922L23.7578 12.5L23.3125 12.0078C23.3125 12.0078 18.502 6.5 12.25 6.5ZM12.25 8C13.9023 8 15.4258 8.45117 16.75 9.05469C17.2275 9.8457 17.5 10.7568 17.5 11.75C17.5 14.46 15.4668 16.6865 12.8359 16.9766C12.8213 16.9795 12.8037 16.9736 12.7891 16.9766C12.6104 16.9854 12.4316 17 12.25 17C12.0508 17 11.8574 16.9883 11.6641 16.9766C9.0332 16.6865 7 14.46 7 11.75C7 10.7715 7.26367 9.86035 7.72656 9.07812H7.70312C9.03906 8.46289 10.5801 8 12.25 8ZM12.25 9.5C11.0078 9.5 10 10.5078 10 11.75C10 12.9922 11.0078 14 12.25 14C13.4922 14 14.5 12.9922 14.5 11.75C14.5 10.5078 13.4922 9.5 12.25 9.5ZM5.6875 10.2031C5.57031 10.707 5.5 11.2139 5.5 11.75C5.5 13.0654 5.875 14.2959 6.53125 15.3359C4.6416 14.2432 3.3291 12.9395 2.89844 12.5C3.25879 12.1309 4.26367 11.1523 5.6875 10.2031ZM18.8125 10.2031C20.2363 11.1523 21.2412 12.1309 21.6016 12.5C21.1709 12.9395 19.8584 14.2432 17.9688 15.3359C18.625 14.2959 19 13.0654 19 11.75C19 11.2139 18.9297 10.7012 18.8125 10.2031Z"
                                                                          fill="#A6A6A6"></path>
                                                                </g>
                                                                <defs>
                                                                    <clipPath id="clip0_4164_81696">
                                                                        <rect width="24" height="24" fill="white" transform="translate(0.25 0.5)">
                                                                        </rect>
                                                                    </clipPath>
                                                                </defs>
                                                            </svg>
                                                        </div>
                                                        <div onclick="ManageCagegory('@item.CategoryId')">
                                                            <svg class="svg-inline--fa fa-pen-to-square text-[#989898] cursor-pointer"
                                                                 aria-hidden="true" focusable="false" data-prefix="far" data-icon="pen-to-square"
                                                                 role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                                                                 data-fa-i2svg="">
                                                                <path fill="currentColor"
                                                                      d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z">
                                                                </path>
                                                            </svg>

                                                        </div>
                                                        <div>
                                                            @if (item.Status.Trim().ToLower() == "a")
                                                            {
                                                                <div onclick="handleBlockCategory('@item.CategoryId')">
                                                                    <i class="las la-lock"></i>
                                                                </div>
                                                            }

                                                            @if (item.Status.Trim().ToLower() == "b")
                                                            {
                                                                <div onclick="handleUnblockCategory('@item.CategoryId')">
                                                                    <i class="las la-unlock"></i>
                                                                </div>
                                                            }
                                                        </div>

                                                    </div>
                                                </td>
                                            </tr>
                                            rowCount++;
                                        }
                                    }
                                </tbody>
                            </table>

                        </div>
                        <!--<div class="pagination-club">-->
                        @*<div class="show-entry">@CRS.ADMIN.APPLICATION.Resources.Resource.Showing 1 to 5 of 301 @CRS.ADMIN.APPLICATION.Resources.Resource.Entries</div>*@
                        <!--<div class="flex gap-[12px]">-->
                        @*<div class="btn btn-secondary-box-shadow ">@CRS.ADMIN.APPLICATION.Resources.Resource.Previous</div>
                    <div class="flex gap-[12px]">
                        <div class="pagination-number active">

                            1
                        </div>
                        <div class="pagination-number">
                            2
                        </div>
                        <div class="pagination-number">
                            3
                        </div>
                        <div class="pagination-number">
                            ..
                        </div>
                        <div class="pagination-number">
                            10
                        </div>

                    </div>
                    <div class="btn btn-secondary-box-shadow ">
                        @CRS.ADMIN.APPLICATION.Resources.Resource.Next
                    </div>*@
                        <!--</div>
                </div>-->
                    </div>

                    @Html.Partial("_ManageCommission", addEditModel)

                </div>
            </div>
            @using (Html.BeginForm("AssignCommission", "CommissionManagement", new { }, FormMethod.Post, new { @id = "AssignCommission" }))
            {
                @Html.AntiForgeryToken()
                <div class="bg-white">
                    <div id="tab2" class="tab-content-plane  hidden">
                        <div class="border border-[#D0D5DD] rounded-[5px] px-[22px] py-5 flex flex-col gap-4">
                            <div class="py-[10px] text-[#3E3E3E] text-sm font-semibold">
                                @CRS.ADMIN.APPLICATION.Resources.Resource.Assign_Commission
                            </div>
                            <div class="grid grid-cols-3 gap-x-12 gap-y-4">
                                <div class=" input-field-common">
                                    <label class="block mb-[12px] text-sm font-medium text-secondary-text-2 ">
                                        @CRS.ADMIN.APPLICATION.Resources.Resource.Location
                                    </label>
                                    <select id="large" name="LocationDDL" class=" default_select select-common block w-full LocationDDL"
                                            style="width: 100%;">
                                        @foreach (var location in ViewBag.LocationList as IEnumerable<SelectListItem>)
                                        {
                                            <option value="@location.Value">@location.Text</option>
                                        }
                                    </select>
                                </div>
                                <div class=" input-field-common">
                                    <label class="block mb-[12px] text-sm font-medium text-secondary-text-2 ">
                                        @CRS.ADMIN.APPLICATION.Resources.Resource.Club
                                    </label>
                                    <select id="large" name="ClubDDL" class=" default_select select-common block w-full ClubDDL"
                                            style="width: 100%;">
                                        <option>@CRS.ADMIN.APPLICATION.Resources.Resource.Select_Club</option>
                                    </select>
                                </div>
                                <div class=" input-field-common">
                                    <label class="block mb-[12px] text-sm font-medium text-secondary-text-2 ">
                                        @CRS.ADMIN.APPLICATION.Resources.Resource.Current_Commission_Category
                                    </label>
                                    <select id="large" name="CurrentCommissionCategoryDDL" class=" default_select select-common block w-full CurrentCommissionCategoryDDL"
                                            style="width: 100%;">
                                        <option>@CRS.ADMIN.APPLICATION.Resources.Resource.Select_Current_Commission_Category</option>
                                    </select>
                                </div>
                                <div class=" input-field-common">
                                    <label class="block mb-[12px] text-sm font-medium text-secondary-text-2 ">
                                        @CRS.ADMIN.APPLICATION.Resources.Resource.New_Commission_Category
                                    </label>
                                    <select id="large" name="NewCommissionCategoryDDL" class=" default_select select-common block w-full NewCommissionCategoryDDL"
                                            style="width: 100%;">
                                        @foreach (var location in ViewBag.CommissionCategoryList as IEnumerable<SelectListItem>)
                                        {
                                            <option value="@location.Value">@location.Text</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <button class="resetForm btn btn-primary-default h-[40px] px-8 rounded-[4px] w-max  text-sm leading-[10px]"
                                    data-drawer-hide="add-new-commision" data-modal-target="add-new-host-modal-save"
                                    data-modal-toggle="add-new-host-modal-save" id="btnAssignCommission">
                                @CRS.ADMIN.APPLICATION.Resources.Resource.Save
                            </button>
                        </div>
                    </div>
                </div>
            }

        </div>
        <!-- tab end  -->
    </div>
</div>

@section scripts
{
    <script>

  $(document).ready(function () {
    var PopUpRenderValue = '@ViewBag.PopUpRenderValue';
        if (PopUpRenderValue != null && PopUpRenderValue != "" && PopUpRenderValue == "Manage")
        {
            var element = document.getElementById('add-new-commision');
            element.classList.remove('translate-x-full');
        }
    });

    function ManageCagegory(categoryId) {
        window.location.href = '/CommissionManagement/ManageCategory?categoryId=' + categoryId;
    }

    const handleBlockCategory = (categoryId) => {
        window.location.href = `/CommissionManagement/BlockCategory?CategoryId=${encodeURIComponent(categoryId)}`;
    }
    const handleUnblockCategory = (categoryId) => {
        window.location.href = `/CommissionManagement/UnBlockCategory?CategoryId=${encodeURIComponent(categoryId)}`;
    }

    const handleCancelClick = () => location.reload();

        const viewSubCategoryList = (categoryId, categoryName) => {
        //window.location.href = `/CommissionManagement/CommissionDetailList?CategoryId=${encodeURIComponent(categoryId)}&CategoryName=${encodeURIComponent(categoryName)}`;
            window.location.href = `/CommissionManagement/AdminCommissionList?CategoryId=${encodeURIComponent(categoryId)}&CategoryName=${encodeURIComponent(categoryName)}`;
    }
    </script>

    <script>
    function AssignCommissionSubmit() {
        var clubDDL = document.getElementsByName("ClubDDL")[0].value;
        var newCommissionDDL = document.getElementsByName("NewCommissionCategoryDDL")[0].value;

        if (!Boolean(clubDDL)) {
            toastr.info('Club is required');
            return false;
        }

        if (!Boolean(newCommissionDDL)) {
            toastr.info('Commission Category is required');
            return false;
        }
        return false;
    }
    var RequestVerificationToken = $('input[name="__RequestVerificationToken"]').val();

        $('.LocationDDL').change(function () {
        $(".ClubDDL").empty().prepend("<option value='' disabled selected>@CRS.ADMIN.APPLICATION.Resources.Resource.Select_Club</option>");
        $(".CurrentCommissionCategoryDDL").empty().prepend("<option value='' disabled selected>@CRS.ADMIN.APPLICATION.Resources.Resource.Select_Current_Commission_Category</option>");
        var locationId = document.getElementsByName("LocationDDL")[0].value;
        if (!Boolean(locationId)) {
            toastr.info('Location is required');
            return false;
        }
        $.ajax({
             type: 'POST',
             async: true,
             url: '@Url.Action("GetClubListByLocation")',
             dataType: 'json',
            data: { '__RequestVerificationToken': RequestVerificationToken, locationId },
            success: function (data) {
                 $.each(data.clubLists, function (i, clubDDL) {
                    $(".ClubDDL").append('<option value="' + clubDDL.Value + '">' + clubDDL.Text + '</option>');
                });
             },
             error: function (ex) {
                toastr.info('Failed to retrive club.');
             }
         });
         return false;
    });

        $('.ClubDDL').change(function () {
         $(".CurrentCommissionCategoryDDL").empty().prepend("<option value='' disabled selected>@CRS.ADMIN.APPLICATION.Resources.Resource.Select_Current_Commission_Category</option>");
         var agentId = document.getElementsByName("ClubDDL")[0].value;
         $.ajax({
             type: 'POST',
             async: true,
             url: '@Url.Action("GetCommissionCategoryByClub")',
             dataType: 'json',
             data: { '__RequestVerificationToken': RequestVerificationToken, agentId },
             success: function (data) {
                 var currentCommissionDDL = $(".CurrentCommissionCategoryDDL");
                 currentCommissionDDL.empty().append('<option value="" disabled selected>@CRS.ADMIN.APPLICATION.Resources.Resource.Select_Current_Commission_Category</option>');

                 $.each(data.commissionLists, function (i, commissionDDl) {
                     currentCommissionDDL.append('<option value="' + commissionDDl.Value + '">' + commissionDDl.Text + '</option>');
                     currentCommissionDDL.val(commissionDDl.Value);

                 });
             },
             error: function (ex) {
                 toastr.info('Failed to retrive current commission category.');
             }
         });
         return false;
    });

        document.getElementById('btnAssignCommission').addEventListener('click',
            function (event) {
            event.preventDefault();
            var AgentId = document.getElementsByName("ClubDDL")[0].value;
            var CommissionCategoryId = document.getElementsByName("NewCommissionCategoryDDL")[0].value;

                if (!AgentId ) {
                event.preventDefault();
                toastr.info('Club is required');
                return false;
                }
                else if (!CommissionCategoryId) {
                event.preventDefault();
                toastr.info('Commission category is required');
                return false;
            }
            else {
                document.getElementById("AssignCommission").submit();
            }
        });
    </script>
}